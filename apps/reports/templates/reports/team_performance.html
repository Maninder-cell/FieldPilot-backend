{% extends "reports/base_report.html" %}

{% block content %}
{% if report.data.teams %}
<h2>Team Performance ({{ report.data.total_teams }} teams)</h2>

{% for team_data in report.data.teams %}
<div class="summary-box" style="page-break-inside: avoid; margin-bottom: 15pt;">
    <h3>{{ team_data.team.name }}</h3>
    
    <div style="background-color: #dbeafe; padding: 6pt; margin: 6pt 0; border-radius: 3pt;">
        <strong>Team Summary:</strong>
        Members: {{ team_data.total_members }} |
        Total Tasks: {{ team_data.total_tasks }} |
        Completed: {{ team_data.completed_tasks }} |
        Completion Rate: {{ team_data.completion_rate|floatformat:1 }}% |
        Total Hours: {{ team_data.total_work_hours|floatformat:2 }}h
    </div>

    {% if team_data.member_contributions %}
    <h4 style="font-size: 9pt; margin-top: 8pt; margin-bottom: 4pt;">Member Contributions</h4>
    <table style="margin-top: 6pt;">
        <thead>
            <tr>
                <th>Technician</th>
                <th>Tasks Completed</th>
                <th>Work Hours</th>
                <th>% of Team Tasks</th>
                <th>% of Team Hours</th>
            </tr>
        </thead>
        <tbody>
            {% for member in team_data.member_contributions %}
            <tr>
                <td>{{ member.technician.name }}</td>
                <td>{{ member.tasks_completed }}</td>
                <td>{{ member.work_hours|floatformat:2 }}h</td>
                <td>
                    {% if team_data.completed_tasks > 0 %}
                        {% widthratio member.tasks_completed team_data.completed_tasks 100 %}%
                    {% else %}
                        0%
                    {% endif %}
                </td>
                <td>
                    {% if team_data.total_work_hours > 0 %}
                        {% widthratio member.work_hours team_data.total_work_hours 100 %}%
                    {% else %}
                        0%
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            <tr style="background-color: #f0f0f0; font-weight: bold;">
                <td>Team Totals:</td>
                <td>{{ team_data.completed_tasks }}</td>
                <td>{{ team_data.total_work_hours|floatformat:2 }}h</td>
                <td>100%</td>
                <td>100%</td>
            </tr>
        </tbody>
    </table>
    {% else %}
    <p style="font-size: 7pt; color: #666; font-style: italic;">No member contributions data</p>
    {% endif %}
</div>

{% if not forloop.last %}
<div style="page-break-after: always;"></div>
{% endif %}

{% endfor %}

{% else %}
<p>No team performance data found.</p>
{% endif %}
{% endblock %}
