{% extends "reports/base_report.html" %}

{% block content %}
{% if report.data.equipment_history %}
<h2>Equipment Maintenance History ({{ report.data.total_equipment }} equipment)</h2>

{% for equipment in report.data.equipment_history %}
<div class="summary-box" style="page-break-inside: avoid; margin-bottom: 12pt;">
    <h3>{{ equipment.name }}</h3>
    <p style="font-size: 7pt; color: #666;">
        Equipment #: {{ equipment.equipment_number }} | 
        Type: {{ equipment.type }} | 
        Status: {{ equipment.operational_status|title }}
    </p>
    
    <div style="background-color: #e0f2fe; padding: 6pt; margin: 6pt 0; border-radius: 3pt;">
        <strong>Maintenance Summary:</strong>
        Total Tasks: {{ equipment.maintenance_summary.total_tasks }} |
        Completed: {{ equipment.maintenance_summary.completed_tasks }}
        {% if equipment.maintenance_summary.last_maintenance_date %}
            | Last Maintenance: {{ equipment.maintenance_summary.last_maintenance_date|date:"m/d/Y" }}
        {% endif %}
    </div>

    {% if equipment.recent_tasks %}
    <table style="margin-top: 8pt;">
        <thead>
            <tr>
                <th>Task #</th>
                <th>Title</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Created</th>
                <th>Scheduled Start</th>
                <th>Scheduled End</th>
            </tr>
        </thead>
        <tbody>
            {% for task in equipment.recent_tasks %}
            <tr>
                <td>{{ task.task_number }}</td>
                <td>{{ task.title }}</td>
                <td>{{ task.status|title }}</td>
                <td>{{ task.priority|title }}</td>
                <td>{{ task.created_at|date:"m/d/Y" }}</td>
                <td>{{ task.scheduled_start|date:"m/d/Y"|default:"-" }}</td>
                <td>{{ task.scheduled_end|date:"m/d/Y"|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="font-size: 7pt; color: #666; font-style: italic;">No recent maintenance tasks</p>
    {% endif %}
</div>

{% if not forloop.last %}
<div style="page-break-after: always;"></div>
{% endif %}

{% endfor %}

{% else %}
<p>No maintenance history found.</p>
{% endif %}
{% endblock %}
